# Новые утилиты загрузки планов ухода

## Описание

Эти утилиты предназначены для загрузки JSON файлов с планами ухода в базу данных без использования поля `input_hash`. Вместо этого используется уникальное ограничение по полям `input_parameters`.

## Файлы

### 1. NewPlanLoader.java
Основной класс для загрузки планов ухода.

**Особенности:**
- Не использует `input_hash`
- Проверяет существование планов по параметрам (culture, region, garden_type)
- Вставляет планы с уникальными параметрами
- Проверяет целостность данных после вставки

**Методы:**
- `extractParametersFromJson()` - извлекает параметры из JSON
- `planExists()` - проверяет существование плана
- `insertPlan()` - вставляет новый план
- `processJsonFile()` - обрабатывает JSON файл

### 2. NewBatchPlanLoader.java
Класс для пакетной обработки всех JSON файлов из директории.

**Особенности:**
- Обрабатывает все JSON файлы в указанной директории
- Показывает статистику обработки
- Подсчитывает успешные, пропущенные и ошибочные файлы

### 3. PlanChecker.java
Утилита для проверки существующих планов в базе данных.

**Особенности:**
- Показывает все планы в базе данных
- Отображает параметры каждого плана
- Сортирует по дате создания

## Использование

### Загрузка всех JSON файлов
```bash
# Запуск пакетной обработки
java -cp target/classes newloader.NewBatchPlanLoader
```

### Проверка существующих планов
```bash
# Просмотр всех планов в базе
java -cp target/classes newloader.PlanChecker
```

### Загрузка одного файла
```java
// В коде
Connection connection = DriverManager.getConnection(...);
NewPlanLoader loader = new NewPlanLoader(connection);
UUID planId = loader.processJsonFile(jsonContent);
```

## Структура JSON файла

```json
{
  "culture": "Томат",
  "region": "Московская область", 
  "garden_type": "открытый грунт",
  "operations": [
    {
      "type": "подкормка",
      "fase": "предпосевная подготовка почвы",
      "description": "Описание операции",
      "period": "апрель",
      "materials": [
        {
          "name": "Перегной",
          "type": "органическое",
          "norm": "4-6 кг/м²",
          "method": "внесение в почву",
          "frequency": "однократно",
          "alternatives": [...]
        }
      ]
    }
  ]
}
```

## Логика работы

1. **Извлечение параметров** - из JSON извлекаются поля `culture`, `region`, `garden_type`
2. **Проверка существования** - проверяется, есть ли уже план с такими параметрами
3. **Вставка** - если план не существует, он вставляется в базу данных
4. **Проверка целостности** - после вставки проверяется, что данные сохранились корректно

## Обработка ошибок

- Если план уже существует, он пропускается
- При ошибках вставки выводится подробная информация
- Проверяется целостность данных после вставки

## Настройка

Перед использованием измените параметры подключения к базе данных в файлах:
- URL базы данных
- Имя пользователя
- Пароль
- Путь к директории с JSON файлами
